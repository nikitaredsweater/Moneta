_type: export
__export_format: 4
__export_date: "2025-12-27T00:00:00.000Z"
__export_source: "insomnia.desktop.app:v2023.5.8"

resources:
  # Workspace
  - _id: wrk_moneta_instrument
    parentId: null
    modified: 1703635200000
    created: 1703635200000
    name: Moneta Instrument API
    description: Collection for Moneta instrument endpoints
    scope: collection
    _type: workspace

  # Base Environment
  - _id: env_instrument_base
    parentId: wrk_moneta_instrument
    modified: 1703635200000
    created: 1703635200000
    name: Base Environment
    data:
      base_url: "http://localhost:8080"
      api_version: v1
    dataPropertyOrder:
      "&":
        - base_url
        - api_version
    color: null
    isPrivate: false
    metaSortKey: 1703635200000
    _type: environment

  # Local Development Environment
  - _id: env_instrument_local
    parentId: env_instrument_base
    modified: 1703635200000
    created: 1703635200000
    name: Local Development
    data:
      base_url: "http://localhost:8080"
      admin_token: ""
      test_instrument_id: ""
      test_document_id: ""
    dataPropertyOrder:
      "&":
        - base_url
        - admin_token
        - test_instrument_id
        - test_document_id
    color: "#7d69cb"
    isPrivate: false
    metaSortKey: 1703635200001
    _type: environment

  # Instrument Folder
  - _id: fld_instrument
    parentId: wrk_moneta_instrument
    modified: 1703635200000
    created: 1703635200000
    name: Instrument
    description: "Instrument management endpoints (/v1/instrument)"
    environment: {}
    environmentPropertyOrder: null
    metaSortKey: -1703635200000
    _type: request_group

  # Search Instruments
  - _id: req_search_instruments
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/search"
    name: "Search Instruments"
    description: |
      Search instruments with filters, pagination, and sorting.

      Required Permission: VIEW.INSTRUMENT

      Filters (all optional):
      - minFaceValue / maxFaceValue: Face value range
      - currency: ISO 4217 currency code (e.g., "USD")
      - maturityDateAfter / maturityDateBefore: Maturity date range
      - createdAtAfter / createdAtBefore: Creation date range
      - minMaturityPayment / maxMaturityPayment: Maturity payment range
      - instrumentStatus: DRAFT, PENDING_APPROVAL, ACTIVE, MATURED, REJECTED
      - maturityStatus: NOT_DUE, DUE, IN_GRACE, PARTIALLY_PAID, PAID, DEFAULTED
      - tradingStatus: OFF_MARKET, DRAFT, LISTED, PAUSED
      - issuerId: Array of issuer company UUIDs
      - createdBy: Array of creator user UUIDs

      Pagination & Sorting:
      - sort: e.g. "-createdAt,name" (prefix with - for desc)
      - limit: 1-200 (default 50)
      - offset: 0+ (default 0)
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "limit": 50,
          "offset": 0,
          "sort": "-createdAt"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635200000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Search Instruments - Active Only
  - _id: req_search_instruments_active
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/search"
    name: "Search Instruments - Active Only"
    description: |
      Search for active instruments only.

      Required Permission: VIEW.INSTRUMENT
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "instrumentStatus": "ACTIVE",
          "limit": 50,
          "offset": 0,
          "sort": "-createdAt"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635199000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Search Instruments - With Value Filters
  - _id: req_search_instruments_value_filters
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/search"
    name: "Search Instruments - Value Filters"
    description: |
      Search instruments with face value and maturity payment filters.

      Required Permission: VIEW.INSTRUMENT
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "minFaceValue": 1000,
          "maxFaceValue": 100000,
          "currency": "USD",
          "minMaturityPayment": 1000,
          "limit": 20,
          "offset": 0,
          "sort": "-faceValue"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635198000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Get Instrument by ID
  - _id: req_get_instrument_by_id
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}"
    name: "Get Instrument by ID"
    description: |
      Get a specific instrument by ID without any includes.

      Required Permission: VIEW.INSTRUMENT

      Set the test_instrument_id environment variable to a valid instrument UUID.
    method: GET
    body: {}
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635197000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Get Instrument - Include Documents
  - _id: req_get_instrument_include_documents
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}"
    name: "Get Instrument - Include Documents"
    description: |
      Get an instrument with its associated documents included.

      Required Permission: VIEW.INSTRUMENT

      Query param: ?include=documents
    method: GET
    body: {}
    parameters:
      - name: include
        value: documents
        id: param_include_documents
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635196000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Create Instrument
  - _id: req_create_instrument
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/"
    name: "Create Instrument"
    description: |
      Create a new instrument (starts in DRAFT status).

      Required Permission: CREATE.INSTRUMENT

      Required fields:
      - name: Instrument name (max 255 chars)
      - faceValue: Face value of the instrument
      - currency: ISO 4217 currency code (3 chars, e.g., "USD")
      - maturityDate: Date when the instrument matures (YYYY-MM-DD)
      - maturityPayment: Payment amount at maturity

      Optional fields:
      - publicPayload: JSON object with custom public data

      Note: issuerId and createdBy are set from the authenticated user.
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "name": "Corporate Bond 2025",
          "faceValue": 10000.00,
          "currency": "USD",
          "maturityDate": "2025-12-31",
          "maturityPayment": 10500.00,
          "publicPayload": {
            "description": "Corporate bond with 5% annual yield",
            "category": "corporate"
          }
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635195000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Create Instrument - Minimal
  - _id: req_create_instrument_minimal
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/"
    name: "Create Instrument - Minimal"
    description: |
      Create an instrument with only required fields.

      Required Permission: CREATE.INSTRUMENT
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "name": "Simple Note",
          "faceValue": 5000.00,
          "currency": "EUR",
          "maturityDate": "2026-06-30",
          "maturityPayment": 5250.00
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635194000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Update Draft Instrument
  - _id: req_update_draft_instrument
    parentId: fld_instrument
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}"
    name: "Update Draft Instrument"
    description: |
      Update a DRAFT instrument. Only DRAFT instruments can be updated.

      Required Permission: UPDATE.INSTRUMENT
      Restriction: Must be from the same company as the issuer.

      Optional fields (at least one required):
      - name: New instrument name
      - faceValue: New face value
      - currency: New currency code
      - maturityDate: New maturity date
      - maturityPayment: New maturity payment
      - publicPayload: New public payload JSON
    method: PATCH
    body:
      mimeType: application/json
      text: |
        {
          "name": "Updated Corporate Bond 2025",
          "faceValue": 15000.00,
          "maturityPayment": 15750.00
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635193000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Status Transitions Folder
  - _id: fld_instrument_transitions
    parentId: wrk_moneta_instrument
    modified: 1703635200000
    created: 1703635200000
    name: Status Transitions
    description: "Instrument status transition endpoints"
    environment: {}
    environmentPropertyOrder: null
    metaSortKey: -1703635150000
    _type: request_group

  # Transition: DRAFT -> PENDING_APPROVAL
  - _id: req_transition_to_pending
    parentId: fld_instrument_transitions
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}/transition"
    name: "Transition: DRAFT -> PENDING_APPROVAL"
    description: |
      Submit a DRAFT instrument for approval.

      Required Permission: UPDATE.INSTRUMENT
      Allowed Roles: ISSUER, ADMIN
      Current Status: DRAFT

      After this transition, the instrument cannot be modified.
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "newStatus": "PENDING_APPROVAL"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635150000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Transition: PENDING_APPROVAL -> ACTIVE
  - _id: req_transition_to_active
    parentId: fld_instrument_transitions
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}/transition"
    name: "Transition: PENDING_APPROVAL -> ACTIVE (Admin)"
    description: |
      Approve a pending instrument and make it active for trading.

      Required Permission: UPDATE.INSTRUMENT
      Allowed Roles: ADMIN only
      Current Status: PENDING_APPROVAL

      Side effects:
      - Sets maturity_status to DUE
      - Records initial ownership (issuer becomes owner)
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "newStatus": "ACTIVE"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635149000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Transition: PENDING_APPROVAL -> REJECTED
  - _id: req_transition_to_rejected
    parentId: fld_instrument_transitions
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}/transition"
    name: "Transition: PENDING_APPROVAL -> REJECTED (Admin)"
    description: |
      Reject a pending instrument.

      Required Permission: UPDATE.INSTRUMENT
      Allowed Roles: ADMIN only
      Current Status: PENDING_APPROVAL
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "newStatus": "REJECTED"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635148000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Document Association Folder
  - _id: fld_instrument_documents
    parentId: wrk_moneta_instrument
    modified: 1703635200000
    created: 1703635200000
    name: Document Association
    description: "Instrument document association endpoints"
    environment: {}
    environmentPropertyOrder: null
    metaSortKey: -1703635120000
    _type: request_group

  # Associate Document with Instrument
  - _id: req_associate_document
    parentId: fld_instrument_documents
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}/documents/{{ _.test_document_id }}"
    name: "Associate Document with Instrument"
    description: |
      Associate an existing document with an instrument.

      Required Permission: UPDATE.INSTRUMENT

      Set test_instrument_id and test_document_id environment variables.
    method: POST
    body: {}
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635120000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Error Cases Folder
  - _id: fld_instrument_errors
    parentId: wrk_moneta_instrument
    modified: 1703635200000
    created: 1703635200000
    name: Error Cases
    description: "Test cases for error scenarios"
    environment: {}
    environmentPropertyOrder: null
    metaSortKey: -1703635100000
    _type: request_group

  # Get Instrument - Not Found (404)
  - _id: req_get_instrument_not_found
    parentId: fld_instrument_errors
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/00000000-0000-0000-0000-000000000000"
    name: "Get Instrument - Not Found (404)"
    description: |
      Test getting an instrument that doesn't exist.

      Expected: 404 Not Found
    method: GET
    body: {}
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635100000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Create Instrument - Missing Fields (422)
  - _id: req_create_instrument_missing_fields
    parentId: fld_instrument_errors
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/"
    name: "Create Instrument - Missing Fields (422)"
    description: |
      Test creating an instrument with missing required fields.

      Expected: 422 Unprocessable Entity
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "name": "Incomplete Instrument"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635099000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Update Non-Draft Instrument (403)
  - _id: req_update_non_draft_instrument
    parentId: fld_instrument_errors
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}"
    name: "Update Non-Draft Instrument (403)"
    description: |
      Test updating an instrument that is not in DRAFT status.

      Expected: 403 Forbidden (InsufficientPermissionsException)

      Note: Set test_instrument_id to an ACTIVE or PENDING_APPROVAL instrument.
    method: PATCH
    body:
      mimeType: application/json
      text: |
        {
          "name": "Should Not Update"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635098000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Invalid Status Transition (403)
  - _id: req_invalid_transition
    parentId: fld_instrument_errors
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}/transition"
    name: "Invalid Status Transition (403)"
    description: |
      Test an invalid status transition (e.g., DRAFT -> ACTIVE directly).

      Expected: 403 Forbidden (InsufficientPermissionsException)
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "newStatus": "ACTIVE"
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635097000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # No Auth Request (401)
  - _id: req_search_instruments_no_auth
    parentId: fld_instrument_errors
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/search"
    name: "Search Instruments - No Auth (401)"
    description: |
      Test accessing instrument search without authentication.

      Expected: 401 Unauthorized
    method: POST
    body:
      mimeType: application/json
      text: |
        {
          "limit": 50
        }
    parameters: []
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication: {}
    metaSortKey: -1703635096000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request

  # Invalid Include Parameter (422)
  - _id: req_get_instrument_invalid_include
    parentId: fld_instrument_errors
    modified: 1703635200000
    created: 1703635200000
    url: "{{ _.base_url }}/{{ _.api_version }}/instrument/{{ _.test_instrument_id }}"
    name: "Get Instrument - Invalid Include (422)"
    description: |
      Test getting an instrument with an invalid include parameter.

      Expected: 422 Unprocessable Entity
    method: GET
    body: {}
    parameters:
      - name: include
        value: invalid_relation
        id: param_invalid_include
    headers:
      - name: Content-Type
        value: application/json
        id: pair_content_type
    authentication:
      type: bearer
      token: "{{ _.admin_token }}"
    metaSortKey: -1703635095000
    isPrivate: false
    settingStoreCookies: true
    settingSendCookies: true
    settingDisableRenderRequestBody: false
    settingEncodeUrl: true
    settingRebuildPath: true
    settingFollowRedirects: global
    _type: request
